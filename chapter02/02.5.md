# 2.5 unicode â€” Unicode ç ç‚¹ã€UTF-8/16 ç¼–ç  #

ä¸–ç•Œä¸­çš„å­—ç¬¦æœ‰è®¸è®¸å¤šå¤šï¼Œæœ‰è‹±æ–‡ï¼Œä¸­æ–‡ï¼ŒéŸ©æ–‡ç­‰ã€‚æˆ‘ä»¬å¼ºçƒˆéœ€è¦ä¸€ä¸ªå¤§å¤§çš„æ˜ å°„è¡¨æŠŠä¸–ç•Œä¸Šçš„å­—ç¬¦æ˜ å°„æˆè®¡ç®—æœºå¯ä»¥é˜…è¯»çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆå­—èŠ‚ï¼‰ã€‚
è¿™æ ·ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ç»™äºˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–ç ï¼Œå°±ä¸ä¼šå‡ºç°å†™æ–‡å­—çš„äººå’Œé˜…è¯»æ–‡å­—çš„äººç¼–ç ä¸åŒè€Œå‡ºç°æ— æ³•è¯»å–çš„ä¹±ç ç°è±¡äº†ã€‚

äºæ˜¯ Unicode å°±å‡ºç°äº†ï¼Œå®ƒæ˜¯ä¸€ç§æ‰€æœ‰ç¬¦å·çš„ç¼–ç æ˜ å°„ã€‚æœ€å¼€å§‹çš„æ—¶å€™ï¼Œunicode è®¤ä¸ºä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ 16 ä½å°±èƒ½åŒ…å«æ‰€æœ‰çš„å­—ç¬¦äº†ã€‚
ä½†æ˜¯éå¸¸å¯æƒœï¼Œä¸¤ä¸ªå­—èŠ‚æœ€å¤šåªèƒ½è¦†ç›– 65536 ä¸ªå­—ç¬¦ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„ï¼Œäºæ˜¯é™„åŠ äº†ä¸€å¥—å­—ç¬¦ç¼–ç ï¼Œå³ unicode4.0ï¼Œé™„åŠ çš„å­—ç¬¦ç”¨ 4 ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚
ç°åœ¨ä¸ºæ­¢ï¼Œå¤§æ¦‚ Unicode å¯ä»¥è¦†ç›– 100 å¤šä¸‡ä¸ªå­—ç¬¦äº†ã€‚

Unicode åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦å’Œä¸€ä¸ªç¼–ç çš„æ˜ å°„ï¼Œä½†æ˜¯å‘¢ï¼Œå¯¹åº”çš„å­˜å‚¨å´æ²¡æœ‰åˆ¶å®šã€‚
æ¯”å¦‚ä¸€ä¸ªç¼–ç  0x0041 ä»£è¡¨å¤§å†™å­—æ¯ Aï¼Œé‚£ä¹ˆå¯èƒ½æœ‰ä¸€ç§å­˜å‚¨è‡³å°‘æœ‰ 4 ä¸ªå­—èŠ‚ï¼Œé‚£å¯èƒ½ 0x00000041 æ¥å­˜å‚¨ä»£è¡¨ Aã€‚
è¿™ä¸ªå°±æ˜¯ unicode çš„å…·ä½“å®ç°ã€‚unicode çš„å…·ä½“å®ç°æœ‰å¾ˆå¤šç§ï¼ŒUTF-8 å’Œ UTF-16 å°±æ˜¯å…¶ä¸­ä¸¤ç§ã€‚

UTF-8 è¡¨ç¤ºæœ€å°‘ç”¨ä¸€ä¸ªå­—èŠ‚å°±èƒ½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦çš„ç¼–ç å®ç°ã€‚å®ƒé‡‡å–çš„æ–¹å¼æ˜¯å¯¹ä¸åŒçš„è¯­è¨€ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå°† unicode ç¼–ç æŒ‰ç…§è¿™ä¸ªæ–¹æ³•è¿›è¡Œè½¬æ¢ã€‚
æˆ‘ä»¬åªè¦è®°ä½æœ€åçš„ç»“æœæ˜¯è‹±æ–‡å ä¸€ä¸ªå­—èŠ‚ï¼Œä¸­æ–‡å ä¸‰ä¸ªå­—èŠ‚ã€‚è¿™ç§ç¼–ç å®ç°æ–¹å¼ä¹Ÿæ˜¯ç°åœ¨åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ–¹å¼äº†ã€‚

UTF-16 è¡¨ç¤ºæœ€å°‘ç”¨ä¸¤ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦çš„ç¼–ç å®ç°ã€‚åŒæ ·æ˜¯å¯¹ unicode ç¼–ç è¿›è¡Œè½¬æ¢ï¼Œå®ƒçš„ç»“æœæ˜¯è‹±æ–‡å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸­æ–‡å ç”¨ä¸¤ä¸ªæˆ–è€…å››ä¸ªå­—èŠ‚ã€‚
å®é™…ä¸Šï¼ŒUTF-16 å°±æ˜¯æœ€ä¸¥æ ¼å®ç°äº† unicode4.0ã€‚ä½†ç”±äºè‹±æ–‡æ˜¯æœ€é€šç”¨çš„è¯­è¨€ï¼Œæ‰€ä»¥æ¨å¹¿ç¨‹åº¦æ²¡æœ‰ UTF-8 é‚£ä¹ˆæ™®åŠã€‚

å›åˆ° go å¯¹ unicode åŒ…çš„æ”¯æŒï¼Œç”±äº UTF-8 çš„ä½œè€… Ken Thompson åŒæ—¶ä¹Ÿæ˜¯ go è¯­è¨€çš„åˆ›å§‹äººï¼Œæ‰€ä»¥è¯´ï¼Œåœ¨å­—ç¬¦æ”¯æŒæ–¹é¢ï¼Œå‡ ä¹æ²¡æœ‰è¯­è¨€çš„ç†è§£ä¼šé«˜äº go äº†ã€‚
go å¯¹ unicode çš„æ”¯æŒåŒ…å«ä¸‰ä¸ªåŒ… :

* unicode
* unicode/utf8
* unicode/utf16

unicode åŒ…åŒ…å«åŸºæœ¬çš„å­—ç¬¦åˆ¤æ–­å‡½æ•°ã€‚utf8 åŒ…ä¸»è¦è´Ÿè´£ rune å’Œ byte ä¹‹é—´çš„è½¬æ¢ã€‚utf16 åŒ…è´Ÿè´£ rune å’Œ uint16 æ•°ç»„ä¹‹é—´çš„è½¬æ¢ã€‚

ç”±äºå­—ç¬¦çš„æ¦‚å¿µæœ‰çš„æ—¶å€™æ¯”è¾ƒæ¨¡ç³Šï¼Œæ¯”å¦‚å­—ç¬¦ï¼ˆå°å†™ aï¼‰æ™®é€šæ˜¾ç¤ºä¸º aï¼Œåœ¨é‡éŸ³å­—ç¬¦ä¸­ï¼ˆgrave-accentedï¼‰ä¸­æ˜¾ç¤ºä¸ºÃ ã€‚
è¿™æ—¶å€™å­—ç¬¦ï¼ˆcharacterï¼‰çš„æ¦‚å¿µå°±æœ‰ç‚¹ä¸å‡†ç¡®äº†ï¼Œå› ä¸º a å’ŒÃ æ˜¾ç„¶æ˜¯ä¸¤ä¸ªä¸åŒçš„ unicode ç¼–ç ï¼Œä½†æ˜¯å´ä»£è¡¨åŒä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¼•å…¥äº† runeã€‚
ä¸€ä¸ª rune å°±ä»£è¡¨ä¸€ä¸ª unicode ç¼–ç ï¼Œæ‰€ä»¥ä¸Šé¢çš„ a å’ŒÃ æ˜¯ä¸¤ä¸ªä¸åŒçš„ runeã€‚

è¿™é‡Œæœ‰ä¸ªè¦æ³¨æ„çš„äº‹æƒ…ï¼Œgo è¯­è¨€çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯ UTF8 çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨ç¨‹åºä¸­çš„å­—ç¬¦ä¸²éƒ½æ˜¯ utf8 ç¼–ç çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å•ä¸ªå­—ç¬¦ï¼ˆå•å¼•å·æ‰©èµ·æ¥çš„ï¼‰å´æ˜¯ unicode çš„ã€‚

## 2.5.1 unicode åŒ… ##

unicode åŒ…å«äº†å¯¹ rune çš„åˆ¤æ–­ã€‚è¿™ä¸ªåŒ…æŠŠæ‰€æœ‰ unicode æ¶‰åŠåˆ°çš„ç¼–ç è¿›è¡Œäº†åˆ†ç±»ï¼Œä½¿ç”¨ç»“æ„

```go
type RangeTable struct {
	R16         []Range16
	R32         []Range32
	LatinOffset int
}
```
æ¥è¡¨ç¤ºè¿™ä¸ªåŠŸèƒ½çš„å­—ç¬¦é›†ã€‚è¿™äº›å­—ç¬¦é›†éƒ½é›†ä¸­åˆ—è¡¨åœ¨ table.go è¿™ä¸ªæºç é‡Œé¢ã€‚

æ¯”å¦‚æ§åˆ¶å­—ç¬¦é›†ï¼š

```go
var _Pc = &RangeTable{
	R16: []Range16{
		{0x005f, 0x203f, 8160},
		{0x2040, 0x2054, 20},
		{0xfe33, 0xfe34, 1},
		{0xfe4d, 0xfe4f, 1},
		{0xff3f, 0xff3f, 1},
	},
}
```

æ¯”å¦‚å¯¹å›½å†…å¼€å‘è€…å¾ˆå®ç”¨çš„æ±‰å­—å­—ç¬¦é›†ï¼š

```go
var _Han = &RangeTable{
	R16: []Range16{
		{0x2e80, 0x2e99, 1},
		{0x2e9b, 0x2ef3, 1},
		{0x2f00, 0x2fd5, 1},
		{0x3005, 0x3005, 1},
		{0x3007, 0x3007, 1},
		{0x3021, 0x3029, 1},
		{0x3038, 0x303b, 1},
		{0x3400, 0x4db5, 1},
		{0x4e00, 0x9fea, 1},
		{0xf900, 0xfa6d, 1},
		{0xfa70, 0xfad9, 1},
	},
	R32: []Range32{
		{0x20000, 0x2a6d6, 1},
		{0x2a700, 0x2b734, 1},
		{0x2b740, 0x2b81d, 1},
		{0x2b820, 0x2cea1, 1},
		{0x2ceb0, 0x2ebe0, 1},
		{0x2f800, 0x2fa1d, 1},
	},
}
```

å›åˆ°åŒ…çš„å‡½æ•°ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸‹é¢è¿™äº›åˆ¤æ–­å‡½æ•°ï¼š

```go
func IsControl(r rune) bool  // æ˜¯å¦æ§åˆ¶å­—ç¬¦
func IsDigit(r rune) bool  // æ˜¯å¦é˜¿æ‹‰ä¼¯æ•°å­—å­—ç¬¦ï¼Œå³ 0-9
func IsGraphic(r rune) bool // æ˜¯å¦å›¾å½¢å­—ç¬¦
func IsLetter(r rune) bool // æ˜¯å¦å­—æ¯
func IsLower(r rune) bool // æ˜¯å¦å°å†™å­—ç¬¦
func IsMark(r rune) bool // æ˜¯å¦ç¬¦å·å­—ç¬¦
func IsNumber(r rune) bool // æ˜¯å¦æ•°å­—å­—ç¬¦ï¼Œæ¯”å¦‚ç½—é©¬æ•°å­—â…§ä¹Ÿæ˜¯æ•°å­—å­—ç¬¦
func IsOneOf(ranges []*RangeTable, r rune) bool // æ˜¯å¦æ˜¯ RangeTable ä¸­çš„ä¸€ä¸ª
func IsPrint(r rune) bool // æ˜¯å¦å¯æ‰“å°å­—ç¬¦
func IsPunct(r rune) bool // æ˜¯å¦æ ‡ç‚¹ç¬¦å·
func IsSpace(r rune) bool // æ˜¯å¦ç©ºæ ¼
func IsSymbol(r rune) bool // æ˜¯å¦ç¬¦å·å­—ç¬¦
func IsTitle(r rune) bool // æ˜¯å¦ title case
func IsUpper(r rune) bool // æ˜¯å¦å¤§å†™å­—ç¬¦
func Is(rangeTab *RangeTable, r rune) bool // r æ˜¯å¦ä¸º rangeTab ç±»å‹çš„å­—ç¬¦
func In(r rune, ranges ...*RangeTable) bool  // r æ˜¯å¦ä¸º ranges ä¸­ä»»æ„ä¸€ä¸ªç±»å‹çš„å­—ç¬¦
```

çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```go
func main() {
	single := '\u0015'
	fmt.Println(unicode.IsControl(single))
	single = '\ufe35'
	fmt.Println(unicode.IsControl(single))

	digit := '1'
	fmt.Println(unicode.IsDigit(digit))
	fmt.Println(unicode.IsNumber(digit))

	letter := 'â…§'
	fmt.Println(unicode.IsDigit(letter))
	fmt.Println(unicode.IsNumber(letter))

	han:='ä½ '
	fmt.Println(unicode.IsDigit(han))
	fmt.Println(unicode.Is(unicode.Han,han))
	fmt.Println(unicode.In(han,unicode.Gujarati,unicode.White_Space))
 }
```

è¾“å‡ºç»“æœï¼š
```bash
true
false
true
true
false
true
false
true
false
```
## 2.5.2 utf8 åŒ… ##

utf8 é‡Œé¢çš„å‡½æ•°å°±æœ‰ä¸€äº›å­—èŠ‚å’Œå­—ç¬¦çš„è½¬æ¢ã€‚

åˆ¤æ–­æ˜¯å¦ç¬¦åˆ utf8 ç¼–ç çš„å‡½æ•°ï¼š
* func Valid(p []byte) bool
* func ValidRune(r rune) bool
* func ValidString(s string) bool

åˆ¤æ–­ rune æ‰€å å­—èŠ‚æ•°ï¼š
* func RuneLen(r rune) int

åˆ¤æ–­å­—èŠ‚ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„ rune æ•°ï¼š
* func RuneCount(p []byte) int
* func RuneCountInString(s string) (n int)

ç¼–ç å’Œè§£ç åˆ° runeï¼š
* func EncodeRune(p []byte, r rune) int
* func DecodeRune(p []byte) (r rune, size int)
* func DecodeRuneInString(s string) (r rune, size int)
* func DecodeLastRune(p []byte) (r rune, size int)
* func DecodeLastRuneInString(s string) (r rune, size int)

æ˜¯å¦ä¸ºå®Œæ•´ runeï¼š
* func FullRune(p []byte) bool
* func FullRuneInString(s string) bool

æ˜¯å¦ä¸º rune ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼š
* func RuneStart(b byte) bool

ç¤ºä¾‹ï¼š
```go
word:=[]byte("ç•Œ")

fmt.Println(utf8.Valid(word[:2]))
fmt.Println(utf8.ValidRune('ç•Œ'))
fmt.Println(utf8.ValidString("ä¸–ç•Œ"))

fmt.Println(utf8.RuneLen('ç•Œ'))

fmt.Println(utf8.RuneCount(word))
fmt.Println(utf8.RuneCountInString("ä¸–ç•Œ"))

p:=make([]byte,3)
utf8.EncodeRune(p,'å¥½')
fmt.Println(p)
fmt.Println(utf8.DecodeRune(p))
fmt.Println(utf8.DecodeRuneInString("ä½ å¥½"))
fmt.Println(utf8.DecodeLastRune([]byte("ä½ å¥½")))
fmt.Println(utf8.DecodeLastRuneInString("ä½ å¥½"))

fmt.Println(utf8.FullRune(word[:2]))
fmt.Println(utf8.FullRuneInString("ä½ å¥½"))

fmt.Println(utf8.RuneStart(word[1]))
fmt.Println(utf8.RuneStart(word[0]))
```

è¿è¡Œç»“æœï¼š
```bash
false
true
true
3
1
2
[229 165 189]
22909 3
20320 3
22909 3
22909 3
false
true
false
true
```

## 2.5.3 utf16 åŒ… ##

utf16 çš„åŒ…çš„å‡½æ•°å°±æ¯”è¾ƒå°‘äº†ã€‚

å°† uint16 å’Œ rune è¿›è¡Œè½¬æ¢

```go
func Encode(s []rune) []uint16
func EncodeRune(r rune) (r1, r2 rune)
func Decode(s []uint16) []rune
func DecodeRune(r1, r2 rune) rune
func IsSurrogate(r rune) bool // æ˜¯å¦ä¸ºæœ‰æ•ˆä»£ç†å¯¹
```

unicode æœ‰ä¸ªåŸºæœ¬å­—ç¬¦å¹³é¢å’Œå¢è¡¥å¹³é¢çš„æ¦‚å¿µï¼ŒåŸºæœ¬å­—ç¬¦å¹³é¢åªæœ‰ 65535 ä¸ªå­—ç¬¦ï¼Œå¢è¡¥å¹³é¢ï¼ˆæœ‰ 16 ä¸ªï¼‰åŠ ä¸Šå»å°±èƒ½è¡¨ç¤º 1114112 ä¸ªå­—ç¬¦ã€‚
utf16 å°±æ˜¯ä¸¥æ ¼å®ç°äº† unicode çš„è¿™ç§ç¼–ç è§„èŒƒã€‚

è€ŒåŸºæœ¬å­—ç¬¦å’Œå¢è¡¥å¹³é¢å­—ç¬¦å°±æ˜¯ä¸€ä¸ªä»£ç†å¯¹ï¼ˆSurrogate Pairï¼‰ã€‚ä¸€ä¸ªä»£ç†å¯¹å¯ä»¥å’Œä¸€ä¸ª rune è¿›è¡Œè½¬æ¢ã€‚

ç¤ºä¾‹ï¼š
```go
words :=[]rune{'ğ“','ğ“‘'}

u16:=utf16.Encode(words)
fmt.Println(u16)
fmt.Println(utf16.Decode(u16))

r1,r2:=utf16.EncodeRune('ğ“')
fmt.Println(r1,r2)
fmt.Println(utf16.DecodeRune(r1,r2))
fmt.Println(utf16.IsSurrogate(r1))
fmt.Println(utf16.IsSurrogate(r2))
fmt.Println(utf16.IsSurrogate(1234))
```

è¾“å‡ºç»“æœï¼š
```bash
[55349 56528 55349 56529]
[120016 120017]
55349 56528
120016
true
true
false
```

# å¯¼èˆª #

- ä¸Šä¸€èŠ‚ï¼š[strings â€” å­—ç¬¦ä¸²æ“ä½œ](02.1.md)
- ä¸‹ä¸€èŠ‚ï¼š[strconv â€” å­—ç¬¦ä¸²å’ŒåŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´è½¬æ¢](02.3.md)